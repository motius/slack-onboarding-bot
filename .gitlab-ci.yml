stages:
  - prepare
  - integrate
  - deploy

# ---------------------------------------------------------------------------------------------- #
# -------------------------------------- VARIABLES --------------------------------------------- #
# ---------------------------------------------------------------------------------------------- # v

variables:
   PROJECT: motius-bot
   CONTAINER_NAME: $PROJECT-$CI_BUILD_REF_NAME
# ---------------------------------------------------------------------------------------------- #
# ---------------------------------------- CLEAN ----------------------------------------------- #
# ---------------------------------------------------------------------------------------------- #
prepare:clean:
   stage: prepare
   script:
       - docker rm -f $PROJECT-$CI_BUILD_REF_NAME
   allow_failure: true
   only:
       - master
   tags:
       - staging

# ---------------------------------------------------------------------------------------------- #
# --------------------------------------- INTEGRATE -------------------------------------------- #
# ---------------------------------------------------------------------------------------------- #
integrate:build:
   stage: integrate
   script:
       - docker-compose build
   tags:
       - staging

# ---------------------------------------------------------------------------------------------- #
# ----------------------------------------- DEPLOY --------------------------------------------- #
# ---------------------------------------------------------------------------------------------- #

deploy:general:
    stage: deploy
    script:
        - docker-compose up -d
    only:
        - master
    tags:
        - staging

# ---------------------------------------------------------------------------------------------- #
# ----------------------------------------- LOGS --------------------------------------------- #
# ---------------------------------------------------------------------------------------------- #

logs:
  stage: deploy
  script:
    - docker-compose logs
  when: manual
  tags:
    - staging


